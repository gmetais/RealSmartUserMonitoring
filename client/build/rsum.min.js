/* RealSmartUserMonitoring 0.1.0 http://github.com/gmetais/RealSmartUserMonitoring */
!function(a,b,c){"use strict";function d(){return(1e3*Date.now()+Math.round(1e3*Math.random())).toString(36)}function e(){if(n.sample<1){if(s.inSample!==c)return s.inSample;var a=Math.random()<n.sample;return s.inSample=a,a}return!0}function f(){function a(){return"complete"===b.readyState?(setTimeout(g,2),!0):!1}a()||b.addEventListener("readystatechange",a)}function g(){var b=a.performance.timing;r.forEach(function(a){t[a]=b[a]-b.fetchStart}),j()&&(t.inBackgroundOnLoad=1,k()),h(),m(),i()}function h(){var a={},b={};r.forEach(function(d){var e=0,f=0,g=0;s.firstPage[d]!==c&&(e+=s.firstPage[d],f++,g=s.firstPage[d]),s.otherPages!==c&&s.otherPages.forEach(function(a){a[d]!==c&&(e+=a[d],f++,g=Math.max(g,a[d]))}),a[d]=Math.round(e/f),a.number=f,b[d]=g}),s.averages=a,s.maximums=b}function i(){var b=new a.XMLHttpRequest;b.open("POST",n.host+"/saveState",!0),b.setRequestHeader("Content-type","text/plain"),b.send(JSON.stringify(s))}function j(){return!(!b.hidden&&!b.webkitHidden)}function k(){function a(){j()||(l(),c.forEach(function(c){b.removeEventListener(c,a)}))}var c=["visibilitychange","webkitvisibilitychange"];c.forEach(function(c){b.addEventListener(c,a)})}function l(){t.timeInBackground=Date.now()-a.performance.timing.fetchStart,m(),i()}function m(){a.localStorage.setItem("rsum",JSON.stringify(s))}var n={},o="/rsum",p=120,q=b.querySelector("script[data-rsum-host],script[data-rsum-sample],script[data-rsum-conversion],script[data-rsum-session-timeout]");null!==q?(n.host=q.getAttribute("data-rsum-host")||o,n.sample=+q.getAttribute("data-rsum-sample")||1,n.conversion="true"===q.getAttribute("data-rsum-conversion"),n.sessionTimeout=+q.getAttribute("data-rsum-session-timeout")||p):a.RSUM_SETTINGS&&(n.host=a.RSUM_SETTINGS.host||o,n.sample=+a.RSUM_SETTINGS.sample||1,n.conversion=a.RSUM_SETTINGS.conversion,n.sessionTimeout=+a.RSUM_SETTINGS.sessionTimeout||p);var r=["responseStart","responseEnd","domInteractive","loadEventEnd"],s=JSON.parse(a.localStorage.getItem("rsum")||"{}");if(s.expireDate!==c&&s.expireDate<Date.now()&&(s={}),s.expireDate===c&&(s.expireDate=Date.now()+60*n.sessionTimeout*1e3,s.sessionId=d()),!e())return m();n.conversion&&(s.conversion=1);var t={pageId:d()};j()&&(t.inBackgroundOnInit=1),s.firstPage===c?s.firstPage=t:(s.otherPages=s.otherPages||[],s.otherPages.push(t)),m(),f(),a.RSUM={conversion:function(){s.conversion===c?(s.conversion=1,m(),i()):console.error("RSUM conversion already sent")},getState:function(){return s}}}(this,this.document);