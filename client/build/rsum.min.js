/* RealSmartUserMonitoring 0.1.0 http://github.com/gmetais/RealSmartUserMonitoring */
!function(a,b,c){"use strict";function d(){return Date.now()+""+Math.round(1e4*Math.random())}function e(){if(m.sample<1){if(p.inSample!==c)return p.inSample;var a=Math.random()<m.sample;return p.inSample=a,a}return!0}function f(){function a(){return"complete"===b.readyState?(setTimeout(g,2),!0):!1}a()||b.addEventListener("readystatechange",a)}function g(){var b=a.performance.timing;q.responseStart=b.responseStart-b.fetchStart,q.responseEnd=b.responseEnd-b.fetchStart,q.domInteractive=b.domInteractive-b.fetchStart,q.loadEventEnd=b.loadEventEnd-b.fetchStart,i()&&(q.inBackgroundOnLoad=1,j()),l(),h()}function h(){var b=new a.XMLHttpRequest;b.open("POST",m.host+"/saveState",!0),b.setRequestHeader("Content-type","text/plain"),b.send(JSON.stringify(p))}function i(){return!(!b.hidden&&!b.webkitHidden)}function j(){function a(){i()||(k(),c.forEach(function(c){b.removeEventListener(c,a)}))}var c=["visibilitychange","webkitvisibilitychange"];c.forEach(function(c){b.addEventListener(c,a)})}function k(){q.timeInBackground=Date.now()-a.performance.timing.fetchStart,console.log("Setting timeInBackground"),l(),h(),console.log(p)}function l(){a.localStorage.setItem("rsum",JSON.stringify(p))}var m={},n="/rsum",o=b.querySelector("script[data-rsum-host],script[data-rsum-sample],script[data-rsum-conversion]");null!==o?(m.host=o.getAttribute("data-rsum-host")||n,m.sample=+o.getAttribute("data-rsum-sample")||1,m.conversion="true"===o.getAttribute("data-rsum-conversion")):a.RSUM_SETTINGS&&(m.host=a.RSUM_SETTINGS.host||n,m.sample=+a.RSUM_SETTINGS.sample||1,m.conversion=a.RSUM_SETTINGS.conversion);var p=JSON.parse(a.localStorage.getItem("rsum")||"{}");if(p.expireDate!==c&&p.expireDate<Date.now()&&(p={}),p.expireDate===c&&(p.sessionId=d()),!e())return l();m.conversion&&(p.conversion=1),p.pages=p.pages||[];var q={pageId:d(),date:Date.now(),firstPage:0===p.pages.length};i()&&(q.inBackgroundOnInit=1),p.pages.push(q),l(),f(),a.RSUM={conversion:function(){p.conversion===c?(p.conversion=1,l(),h()):console.error("RSUM conversion already sent")},getState:function(){return p}}}(this,this.document);